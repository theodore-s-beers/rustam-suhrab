import{t as H,a as I,c as oe}from"../chunks/CWAYeBTa.js";import{x as ue,b as he,s as V,h as O,q as le,a as de,A as u,a3 as me,c as ce,r as G,d as Y,g as S,Z as fe,e as ae,f as re,p as ve,a4 as q,a1 as se,w as J,a5 as X,a6 as be,a7 as Z,a8 as ge,a9 as pe,a0 as _e,aa as Ne,k as xe,ab as we,ac as ye,W as Te,S as ke,ad as Ee,ae as Oe,af as Pe,G as We,ag as B,ah as F,I as Q,L as k,J as M,K as Ae,ai as D,aj as Le,ak as Ie,m as y,o as x,al as Se}from"../chunks/C9rBuFmc.js";import{d as Me,h as $e,e as Ce,s as E}from"../chunks/Chg_53D_.js";import{i as j}from"../chunks/mfL5n9QS.js";import{o as Re}from"../chunks/BX2jUikl.js";function De(e,t,a,i){for(var d=[],o=t.length,m=0;m<o;m++)pe(t[m].e,d,!0);var p=o>0&&d.length===0&&a!==null;if(p){var _=a.parentNode;_e(_),_.append(a),i.clear(),W(e,t[0].prev,t[o-1].next)}Ne(d,()=>{for(var c=0;c<o;c++){var n=t[c];p||(i.delete(n.k),W(e,n.prev,n.next)),xe(n.e,!p)}})}function He(e,t,a,i,d,o=null){var m=e,p={flags:t,items:new Map,first:null};{var _=e;m=O?V(le(_)):_.appendChild(ue())}O&&de();var c=null,n=!1,v=me(()=>{var s=a();return ke(s)?s:s==null?[]:se(s)});he(()=>{var s=u(v),r=s.length;if(n&&r===0)return;n=r===0;let h=!1;if(O){var N=m.data===ce;N!==(r===0)&&(m=G(),V(m),Y(!1),h=!0)}if(O){for(var T=null,l,b=0;b<r;b++){if(S.nodeType===8&&S.data===fe){m=S,h=!0,Y(!1);break}var w=s[b],f=i(w,b);l=ie(S,p,T,null,w,f,b,d,t,a),p.items.set(f,l),T=l}r>0&&V(G())}O||Ue(s,p,m,d,t,i,a),o!==null&&(r===0?c?ae(c):c=re(()=>o(m)):c!==null&&ve(c,()=>{c=null})),h&&Y(!0),u(v)}),O&&(m=S)}function Ue(e,t,a,i,d,o,m){var p=e.length,_=t.items,c=t.first,n=c,v,s=null,r=[],h=[],N,T,l,b;for(b=0;b<p;b+=1){if(N=e[b],T=o(N,b),l=_.get(T),l===void 0){var w=n?n.e.nodes_start:a;s=ie(w,t,s,s===null?t.first:s.next,N,T,b,i,d,m),_.set(T,s),r=[],h=[],n=s.next;continue}if(Ve(l,N,b),(l.e.f&q)!==0&&ae(l.e),l!==n){if(v!==void 0&&v.has(l)){if(r.length<h.length){var f=h[0],g;s=f.prev;var A=r[0],P=r[r.length-1];for(g=0;g<r.length;g+=1)ee(r[g],f,a);for(g=0;g<h.length;g+=1)v.delete(h[g]);W(t,A.prev,P.next),W(t,s,A),W(t,P,f),n=f,s=P,b-=1,r=[],h=[]}else v.delete(l),ee(l,n,a),W(t,l.prev,l.next),W(t,l,s===null?t.first:s.next),W(t,s,l),s=l;continue}for(r=[],h=[];n!==null&&n.k!==T;)(n.e.f&q)===0&&(v??(v=new Set)).add(n),h.push(n),n=n.next;if(n===null)continue;l=n}r.push(l),s=l,n=l.next}if(n!==null||v!==void 0){for(var L=v===void 0?[]:se(v);n!==null;)(n.e.f&q)===0&&L.push(n),n=n.next;var $=L.length;if($>0){var U=p===0?a:null;De(t,L,U,_)}}J.first=t.first&&t.first.e,J.last=s&&s.e}function Ve(e,t,a,i){X(e.v,t),X(e.i,a)}function ie(e,t,a,i,d,o,m,p,_,c){var n=(_&we)!==0,v=(_&ye)===0,s=n?v?be(d):Z(d):d,r=(_&ge)===0?m:Z(m),h={i:r,v:s,k:o,a:null,e:null,prev:a,next:i};try{return h.e=re(()=>p(e,s,r,c),O),h.e.prev=a&&a.e,h.e.next=i&&i.e,a===null?t.first=h:(a.next=h,a.e.next=h.e),i!==null&&(i.prev=h,i.e.prev=h.e),h}finally{}}function ee(e,t,a){for(var i=e.next?e.next.e.nodes_start:a,d=t?t.e.nodes_start:a,o=e.e.nodes_start;o!==i;){var m=Te(o);d.before(o),o=m}}function W(e,t,a){t===null?e.first=a:(t.next=a,t.e.next=a&&a.e),a!==null&&(a.prev=t,a.e.prev=t&&t.e)}function Ye(e,t){return e==null?null:String(e)}function qe(e,t,a,i){var d=e.__style;if(O||d!==t){var o=Ye(t);(!O||o!==e.getAttribute("style"))&&(o==null?e.removeAttribute("style"):e.style.cssText=o),e.__style=t}return i}const Be=Symbol("is custom element"),Ke=Symbol("is html");function ze(e,t,a,i){var d=Ge(e);O&&(d[t]=e.getAttribute(t),e.nodeName==="LINK")||d[t]!==(d[t]=a)&&(a==null?e.removeAttribute(t):typeof a!="string"&&Je(e).includes(t)?e[t]=a:e.setAttribute(t,a))}function Ge(e){return e.__attributes??(e.__attributes={[Be]:e.nodeName.includes("-"),[Ke]:e.namespaceURI===Ee})}var te=new Map;function Je(e){var t=te.get(e.nodeName);if(t)return t;te.set(e.nodeName,t=[]);for(var a,i=e,d=Element.prototype;d!==i;){a=Pe(i);for(var o in a)a[o].set&&t.push(o);i=Oe(i)}return t}const Xe=[{volumeNumber:2,pageNumber:117,editor:"tsb",heading:!0,headingText:"داستان رستم و سهراب",numberWithinPage:1,hemistichOne:{},hemistichTwo:{}},{volumeNumber:2,pageNumber:117,editor:"tsb",heading:!1,numberWithinPage:2,hemistichOne:{text:"اگر تندبادی برآید ز کنج",hasNotes:!1},hemistichTwo:{text:"به خاک افگند نارسیده ترنج",hasNotes:!0}},{volumeNumber:2,pageNumber:117,editor:"tsb",heading:!1,numberWithinPage:3,hemistichOne:{text:"ستمگاره خوانیمش ار دادگر",hasNotes:!0},hemistichTwo:{text:"هنرمند گوییمش ار بی‌هنر",hasNotes:!0}},{volumeNumber:2,pageNumber:117,editor:"tsb",heading:!1,numberWithinPage:4,hemistichOne:{text:"اگر مرگ دادست بیداد چیست",hasNotes:!1},hemistichTwo:{text:"ز داد این همه بانگ و فریاد چیست",hasNotes:!0}},{volumeNumber:2,pageNumber:117,editor:"tsb",heading:!1,numberWithinPage:5,hemistichOne:{text:"ازین راز جان تو آگاه نیست",hasNotes:!1},hemistichTwo:{text:"بدین پرده اندر ترا راه نیست",hasNotes:!0}},{volumeNumber:2,pageNumber:117,editor:"tsb",heading:!1,numberWithinPage:6,numberListed:5,hemistichOne:{text:"همه تا در آز رفته فراز",hasNotes:!1},hemistichTwo:{text:"به کس بر نشد این در راز باز",hasNotes:!0}},{volumeNumber:2,pageNumber:118,editor:"tsb",heading:!1,numberWithinPage:1,hemistichOne:{text:"به رفتن مگر بهتر آیدت جای",hasNotes:!0},hemistichTwo:{text:"چو آرام گیری به دیگر سرای",hasNotes:!0}},{volumeNumber:2,pageNumber:118,editor:"tsb",heading:!0,headingText:"آغاز داستان",numberWithinPage:2,hemistichOne:{},hemistichTwo:{}},{volumeNumber:2,pageNumber:118,editor:"tsb",heading:!1,numberWithinPage:3,hemistichOne:{text:"ز گفتار دهقان یکی داستان",hasNotes:!1},hemistichTwo:{text:"بپیوندم از گفتهٔ باستان",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:1,hemistichOne:{text:"ز موبد برین گونه برداشت یاد",hasNotes:!0},hemistichTwo:{text:"که یک روز رستم هم از بامداد",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:2,hemistichOne:{text:"غمی بد دلش ساز نخچیر کرد",hasNotes:!0},hemistichTwo:{text:"کمر بست و ترکش پر از تیر کرد",hasNotes:!1}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:3,numberListed:10,hemistichOne:{text:"چو نزدیکی مرز توران رسید",hasNotes:!0},hemistichTwo:{text:"بیابان سراسر پر از گور دید",hasNotes:!1}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:4,hemistichOne:{text:"برافروخت چون گل رخ تاج‌بخش",hasNotes:!1},hemistichTwo:{text:"بخندید و ز جای برکند رخش",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:5,hemistichOne:{text:"به تیر و کمان و به گرز و کمند",hasNotes:!1},hemistichTwo:{text:"بیفگند بر دشت نخچیر چند",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:6,hemistichOne:{text:"ز خاشاک و از خار و شاخ درخت",hasNotes:!0},hemistichTwo:{text:"یکی آتشی برفروزید سخت",hasNotes:!1}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:7,hemistichOne:{text:"چو آتش پراگنده شد پیلتن",hasNotes:!1},hemistichTwo:{text:"درختی بجست از در بابزن",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:8,numberListed:15,hemistichOne:{text:"یکی ترّه‌گوری بزد بر درخت",hasNotes:!1},hemistichTwo:{text:"که در چنگ او پرّ مرغی نسخت",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:9,hemistichOne:{text:"چو بریان شد از هم بکند و بخورد",hasNotes:!1},hemistichTwo:{text:"ز مغر استخوانش برآورد گرد",hasNotes:!1}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:10,hemistichOne:{text:"بخفت و برآسود از روزگار",hasNotes:!1},hemistichTwo:{text:"چمان و چران رخش در مرغزار",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:11,hemistichOne:{text:"سواران ترکان تنی هفت هشت",hasNotes:!0},hemistichTwo:{text:"بر آن دشت نخچیرگان برگذشت",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:12,hemistichOne:{text:"پی اسپ دیدند در مرغزار",hasNotes:!0},hemistichTwo:{text:"بگشتند گرد لب جویبار",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:13,numberListed:20,hemistichOne:{text:"چو بر دشت مر رخش را یافتند",hasNotes:!0},hemistichTwo:{text:"سوی بند کردنش بشتافتند",hasNotes:!1}}];var Ze=H('<div role="tooltip" class="absolute z-10 w-64 -translate-x-1/2 rounded-md border border-gray-600 bg-gray-200 px-2.5 py-2 text-sm"><div>Vol. <code class="text-pink-800"> </code>, pg. <code class="text-pink-800"> </code>, line <code class="text-pink-800"> </code> (relative)</div> <div><a target="_blank" rel="noreferrer" class="text-blue-800 hover:underline">View page image</a></div></div>'),Fe=(e,t,a)=>t(e,u(a)[0]),Qe=(e,t,a)=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),t(e,u(a)[0]))},je=(e,t,a)=>t(e,u(a)),et=(e,t,a)=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),t(e,u(a)))},tt=H('<div role="button" tabindex="0" class="mt-4 mr-12 mb-6 text-3xl"> </div>'),at=(e,t,a)=>t(e,u(a)),rt=(e,t,a)=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),t(e,u(a)))},st=(e,t,a)=>t(e,u(a)),it=(e,t,a)=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),t(e,u(a)))},nt=H('<div class="flex gap-2"><div class="w-12"> </div> <div role="button" tabindex="0" class="ml-16 w-64 [text-align-last:justify]"> <span class="text-green-700"> </span></div> <div role="button" tabindex="0" class="w-64 [text-align-last:justify]"> <span class="text-green-700"> </span></div></div>'),ot=H('<!> <div role="button" tabindex="0" class="mr-12 mb-8 place-self-center text-4xl"> </div> <div dir="rtl" lang="fa" class="flex flex-col place-items-center gap-4 text-lg"></div>',1);function ct(e,t){We(t,!0);let a=B(F(Xe)),i=B(null),d=B(F({top:0,left:0}));function o(s,r){const N=s.currentTarget.getBoundingClientRect();D(d,{top:N.bottom+window.scrollY+6,left:window.innerWidth/2-24},!0),D(i,u(i)===r?null:r,!0)}Re(async()=>{const s=new URLSearchParams;s.append("start-vol","2"),s.append("start-pg","117"),s.append("start-line","1"),s.append("end-vol","2"),s.append("end-pg","199"),s.append("end-line","5"),s.append("editor","tsb");try{const r=await fetch(`https://shahnama-transcription.pages.dev/api/transcribed-lines?${s.toString()}`);if(!r.ok)throw new Error(`${r.status}; ${await r.text()}`);D(a,await r.json(),!0)}catch(r){r instanceof Error?console.error("Error fetching data:",r.message):console.error("Unexpected error:",r)}});var m=ot();$e(s=>{M(()=>Le.title=u(a)[0].headingText)}),Ce("keydown",Ie,s=>{if(s.key==="Escape"){D(i,null);const r=document.activeElement;r instanceof HTMLElement&&r.blur()}});var p=Q(m);{var _=s=>{var r=Ze(),h=y(r),N=k(y(h)),T=y(N,!0);x(N);var l=k(N,2),b=y(l,!0);x(l);var w=k(l,2),f=y(w,!0);x(w),Se(),x(h);var g=k(h,2),A=y(g);x(g),x(r),M(()=>{qe(r,`top: ${u(d).top??""}px; left: ${u(d).left??""}px`),E(T,u(i).volumeNumber),E(b,u(i).pageNumber),E(f,u(i).numberWithinPage),ze(A,"href",`https://read.akvan.dev/km/${u(i).volumeNumber??""}/${u(i).pageNumber??""}`)}),I(s,r)};j(p,s=>{u(i)&&s(_)})}var c=k(p,2);c.__click=[Fe,o,a],c.__keydown=[Qe,o,a];var n=y(c,!0);x(c);var v=k(c,2);He(v,23,()=>u(a),s=>`${s.volumeNumber}-${s.pageNumber}-${s.numberWithinPage}`,(s,r,h)=>{var N=oe(),T=Q(N);{var l=w=>{var f=tt();f.__click=[je,o,r],f.__keydown=[et,o,r];var g=y(f,!0);x(f),M(()=>E(g,u(r).headingText)),I(w,f)},b=w=>{var f=nt(),g=y(f),A=y(g,!0);x(g);var P=k(g,2);P.__click=[at,o,r],P.__keydown=[rt,o,r];var L=y(P,!0),$=k(L),U=y($,!0);x($),x(P);var C=k(P,2);C.__click=[st,o,r],C.__keydown=[it,o,r];var K=y(C,!0),z=k(K),ne=y(z,!0);x(z),x(C),x(f),M(R=>{E(A,R),E(L,u(r).hemistichOne.text),E(U,u(r).hemistichOne.hasNotes?"*":""),E(K,u(r).hemistichTwo.text),E(ne,u(r).hemistichTwo.hasNotes?"*":"")},[()=>{var R;return(R=u(r).numberListed)==null?void 0:R.toLocaleString("fa")}]),I(w,f)};j(T,w=>{u(r).heading&&u(h)!==0?w(l):w(b,!1)})}I(s,N)}),x(v),M(()=>{E(n,u(a)[0].headingText),v.dir=v.dir}),I(e,m),Ae()}Me(["click","keydown"]);export{ct as component};
