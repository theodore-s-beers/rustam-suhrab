import{t as U,a as I,c as le}from"../chunks/CWAYeBTa.js";import{x as he,b as de,s as V,h as O,q as me,a as ce,A as l,a3 as ve,c as fe,r as G,d as Y,g as S,Z as be,e as re,f as se,p as ge,a4 as q,a1 as ie,w as J,a5 as X,a6 as pe,a7 as Z,a8 as _e,a9 as Ne,a0 as xe,aa as we,k as ye,ab as Te,ac as ke,W as Ee,S as Oe,ad as Pe,ae as We,af as Ae,G as Le,ag as B,ah as F,I as Q,m as w,J as M,K as Ie,ai as H,aj as Se,ak as Me,L as k,o as p,al as j}from"../chunks/C9rBuFmc.js";import{d as $e,h as Ce,e as Re,s as E}from"../chunks/Chg_53D_.js";import{i as ee}from"../chunks/mfL5n9QS.js";import{o as De}from"../chunks/BX2jUikl.js";function He(e,t,a,n){for(var h=[],u=t.length,m=0;m<u;m++)Ne(t[m].e,h,!0);var _=u>0&&h.length===0&&a!==null;if(_){var N=a.parentNode;xe(N),N.append(a),n.clear(),A(e,t[0].prev,t[u-1].next)}we(h,()=>{for(var f=0;f<u;f++){var i=t[f];_||(n.delete(i.k),A(e,i.prev,i.next)),ye(i.e,!_)}})}function Ue(e,t,a,n,h,u=null){var m=e,_={flags:t,items:new Map,first:null};{var N=e;m=O?V(me(N)):N.appendChild(he())}O&&ce();var f=null,i=!1,x=ve(()=>{var o=a();return Oe(o)?o:o==null?[]:ie(o)});de(()=>{var o=l(x),s=o.length;if(i&&s===0)return;i=s===0;let r=!1;if(O){var y=m.data===fe;y!==(s===0)&&(m=G(),V(m),Y(!1),r=!0)}if(O){for(var b=null,d,c=0;c<s;c++){if(S.nodeType===8&&S.data===be){m=S,r=!0,Y(!1);break}var W=o[c],g=n(W,c);d=ne(S,_,b,null,W,g,c,h,t,a),_.items.set(g,d),b=d}s>0&&V(G())}O||Ve(o,_,m,h,t,n,a),u!==null&&(s===0?f?re(f):f=se(()=>u(m)):f!==null&&ge(f,()=>{f=null})),r&&Y(!0),l(x)}),O&&(m=S)}function Ve(e,t,a,n,h,u,m){var _=e.length,N=t.items,f=t.first,i=f,x,o=null,s=[],r=[],y,b,d,c;for(c=0;c<_;c+=1){if(y=e[c],b=u(y,c),d=N.get(b),d===void 0){var W=i?i.e.nodes_start:a;o=ne(W,t,o,o===null?t.first:o.next,y,b,c,n,h,m),N.set(b,o),s=[],r=[],i=o.next;continue}if(Ye(d,y,c),(d.e.f&q)!==0&&re(d.e),d!==i){if(x!==void 0&&x.has(d)){if(s.length<r.length){var g=r[0],v;o=g.prev;var T=s[0],L=s[s.length-1];for(v=0;v<s.length;v+=1)te(s[v],g,a);for(v=0;v<r.length;v+=1)x.delete(r[v]);A(t,T.prev,L.next),A(t,o,T),A(t,L,g),i=g,o=L,c-=1,s=[],r=[]}else x.delete(d),te(d,i,a),A(t,d.prev,d.next),A(t,d,o===null?t.first:o.next),A(t,o,d),o=d;continue}for(s=[],r=[];i!==null&&i.k!==b;)(i.e.f&q)===0&&(x??(x=new Set)).add(i),r.push(i),i=i.next;if(i===null)continue;d=i}s.push(d),o=d,i=d.next}if(i!==null||x!==void 0){for(var P=x===void 0?[]:ie(x);i!==null;)(i.e.f&q)===0&&P.push(i),i=i.next;var $=P.length;if($>0){var C=_===0?a:null;He(t,P,C,N)}}J.first=t.first&&t.first.e,J.last=o&&o.e}function Ye(e,t,a,n){X(e.v,t),X(e.i,a)}function ne(e,t,a,n,h,u,m,_,N,f){var i=(N&Te)!==0,x=(N&ke)===0,o=i?x?pe(h):Z(h):h,s=(N&_e)===0?m:Z(m),r={i:s,v:o,k:u,a:null,e:null,prev:a,next:n};try{return r.e=se(()=>_(e,o,s,f),O),r.e.prev=a&&a.e,r.e.next=n&&n.e,a===null?t.first=r:(a.next=r,a.e.next=r.e),n!==null&&(n.prev=r,n.e.prev=r.e),r}finally{}}function te(e,t,a){for(var n=e.next?e.next.e.nodes_start:a,h=t?t.e.nodes_start:a,u=e.e.nodes_start;u!==n;){var m=Ee(u);h.before(u),u=m}}function A(e,t,a){t===null?e.first=a:(t.next=a,t.e.next=a&&a.e),a!==null&&(a.prev=t,a.e.prev=t&&t.e)}function qe(e,t){return e==null?null:String(e)}function Be(e,t,a,n){var h=e.__style;if(O||h!==t){var u=qe(t);(!O||u!==e.getAttribute("style"))&&(u==null?e.removeAttribute("style"):e.style.cssText=u),e.__style=t}return n}const Ke=Symbol("is custom element"),ze=Symbol("is html");function Ge(e,t,a,n){var h=Je(e);O&&(h[t]=e.getAttribute(t),e.nodeName==="LINK")||h[t]!==(h[t]=a)&&(a==null?e.removeAttribute(t):typeof a!="string"&&Xe(e).includes(t)?e[t]=a:e.setAttribute(t,a))}function Je(e){return e.__attributes??(e.__attributes={[Ke]:e.nodeName.includes("-"),[ze]:e.namespaceURI===Pe})}var ae=new Map;function Xe(e){var t=ae.get(e.nodeName);if(t)return t;ae.set(e.nodeName,t=[]);for(var a,n=e,h=Element.prototype;h!==n;){a=Ae(n);for(var u in a)a[u].set&&t.push(u);n=We(n)}return t}const Ze=[{volumeNumber:2,pageNumber:117,editor:"tsb",heading:!0,headingText:"داستان رستم و سهراب",numberWithinPage:1,hemistichOne:{},hemistichTwo:{}},{volumeNumber:2,pageNumber:117,editor:"tsb",heading:!1,numberWithinPage:2,hemistichOne:{text:"اگر تندبادی برآید ز کنج",hasNotes:!1},hemistichTwo:{text:"به خاک افگند نارسیده ترنج",hasNotes:!0}},{volumeNumber:2,pageNumber:117,editor:"tsb",heading:!1,numberWithinPage:3,hemistichOne:{text:"ستمگاره خوانیمش ار دادگر",hasNotes:!0},hemistichTwo:{text:"هنرمند گوییمش ار بی‌هنر",hasNotes:!0}},{volumeNumber:2,pageNumber:117,editor:"tsb",heading:!1,numberWithinPage:4,hemistichOne:{text:"اگر مرگ دادست بیداد چیست",hasNotes:!1},hemistichTwo:{text:"ز داد این همه بانگ و فریاد چیست",hasNotes:!0}},{volumeNumber:2,pageNumber:117,editor:"tsb",heading:!1,numberWithinPage:5,hemistichOne:{text:"ازین راز جان تو آگاه نیست",hasNotes:!1},hemistichTwo:{text:"بدین پرده اندر ترا راه نیست",hasNotes:!0}},{volumeNumber:2,pageNumber:117,editor:"tsb",heading:!1,numberWithinPage:6,numberListed:5,hemistichOne:{text:"همه تا در آز رفته فراز",hasNotes:!1},hemistichTwo:{text:"به کس بر نشد این در راز باز",hasNotes:!0}},{volumeNumber:2,pageNumber:118,editor:"tsb",heading:!1,numberWithinPage:1,hemistichOne:{text:"به رفتن مگر بهتر آیدت جای",hasNotes:!0},hemistichTwo:{text:"چو آرام گیری به دیگر سرای",hasNotes:!0}},{volumeNumber:2,pageNumber:118,editor:"tsb",heading:!0,headingText:"آغاز داستان",numberWithinPage:2,hemistichOne:{},hemistichTwo:{}},{volumeNumber:2,pageNumber:118,editor:"tsb",heading:!1,numberWithinPage:3,hemistichOne:{text:"ز گفتار دهقان یکی داستان",hasNotes:!1},hemistichTwo:{text:"بپیوندم از گفتهٔ باستان",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:1,hemistichOne:{text:"ز موبد برین گونه برداشت یاد",hasNotes:!0},hemistichTwo:{text:"که یک روز رستم هم از بامداد",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:2,hemistichOne:{text:"غمی بد دلش ساز نخچیر کرد",hasNotes:!0},hemistichTwo:{text:"کمر بست و ترکش پر از تیر کرد",hasNotes:!1}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:3,numberListed:10,hemistichOne:{text:"چو نزدیکی مرز توران رسید",hasNotes:!0},hemistichTwo:{text:"بیابان سراسر پر از گور دید",hasNotes:!1}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:4,hemistichOne:{text:"برافروخت چون گل رخ تاج‌بخش",hasNotes:!1},hemistichTwo:{text:"بخندید و ز جای برکند رخش",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:5,hemistichOne:{text:"به تیر و کمان و به گرز و کمند",hasNotes:!1},hemistichTwo:{text:"بیفگند بر دشت نخچیر چند",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:6,hemistichOne:{text:"ز خاشاک و از خار و شاخ درخت",hasNotes:!0},hemistichTwo:{text:"یکی آتشی برفروزید سخت",hasNotes:!1}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:7,hemistichOne:{text:"چو آتش پراگنده شد پیلتن",hasNotes:!1},hemistichTwo:{text:"درختی بجست از در بابزن",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:8,numberListed:15,hemistichOne:{text:"یکی ترّه‌گوری بزد بر درخت",hasNotes:!1},hemistichTwo:{text:"که در چنگ او پرّ مرغی نسخت",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:9,hemistichOne:{text:"چو بریان شد از هم بکند و بخورد",hasNotes:!1},hemistichTwo:{text:"ز مغر استخوانش برآورد گرد",hasNotes:!1}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:10,hemistichOne:{text:"بخفت و برآسود از روزگار",hasNotes:!1},hemistichTwo:{text:"چمان و چران رخش در مرغزار",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:11,hemistichOne:{text:"سواران ترکان تنی هفت هشت",hasNotes:!0},hemistichTwo:{text:"بر آن دشت نخچیرگان برگذشت",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:12,hemistichOne:{text:"پی اسپ دیدند در مرغزار",hasNotes:!0},hemistichTwo:{text:"بگشتند گرد لب جویبار",hasNotes:!0}},{volumeNumber:2,pageNumber:119,editor:"tsb",heading:!1,numberWithinPage:13,numberListed:20,hemistichOne:{text:"چو بر دشت مر رخش را یافتند",hasNotes:!0},hemistichTwo:{text:"سوی بند کردنش بشتافتند",hasNotes:!1}}];var Fe=U('<div role="tooltip" class="absolute z-10 w-64 -translate-x-1/2 rounded-md border border-gray-600 bg-gray-200 px-2.5 py-2 text-sm"><div class="mb-1">Vol. <code class="text-pink-800"> </code>, pg. <code class="text-pink-800"> </code>, line <code class="text-pink-800"> </code> (relative)</div> <div class="flex"><a target="_blank" rel="noreferrer" class="text-blue-800 hover:underline">View page image</a> <span class="ml-auto italic">Esc to clear</span></div></div>'),Qe=(e,t,a)=>t(e,l(a)[0]),je=(e,t,a)=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),t(e,l(a)[0]))},et=(e,t,a)=>t(e,l(a)),tt=(e,t,a)=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),t(e,l(a)))},at=U('<div role="button" tabindex="0" class="mt-4 mr-12 mb-6 text-3xl"> </div>'),rt=(e,t,a)=>t(e,l(a)),st=(e,t,a)=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),t(e,l(a)))},it=(e,t,a)=>t(e,l(a)),nt=(e,t,a)=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),t(e,l(a)))},ot=U('<div class="flex gap-2"><div class="w-12"> </div> <div role="button" tabindex="0" class="ml-16 w-64 [text-align-last:justify]"> <span class="text-green-700"> </span></div> <div role="button" tabindex="0" class="w-64 [text-align-last:justify]"> <span class="text-green-700"> </span></div></div>'),ut=U('<!> <div class="flex justify-center"><div role="button" tabindex="0" class="mr-12 mb-8 text-4xl"> </div></div> <div dir="rtl" lang="fa" class="flex flex-col place-items-center gap-4 text-lg"></div>',1);function vt(e,t){Le(t,!0);let a=B(F(Ze)),n=B(null),h=B(F({top:0,left:0}));function u(s,r){const b=s.currentTarget.getBoundingClientRect();H(h,{top:b.bottom+window.scrollY+6,left:window.innerWidth/2-24},!0),H(n,l(n)===r?null:r,!0)}De(async()=>{const s=new URLSearchParams;s.append("start-vol","2"),s.append("start-pg","117"),s.append("start-line","1"),s.append("end-vol","2"),s.append("end-pg","199"),s.append("end-line","5"),s.append("editor","tsb");try{const r=await fetch(`https://shahnama-transcription.pages.dev/api/transcribed-lines?${s.toString()}`);if(!r.ok)throw new Error(`${r.status}; ${await r.text()}`);H(a,await r.json(),!0)}catch(r){r instanceof Error?console.error("Error fetching data:",r.message):console.error("Unexpected error:",r)}});var m=ut();Ce(s=>{M(()=>Se.title=l(a)[0].headingText)}),Re("keydown",Me,s=>{if(s.key==="Escape"){H(n,null);const r=document.activeElement;r instanceof HTMLElement&&r.blur()}});var _=Q(m);{var N=s=>{var r=Fe(),y=w(r),b=k(w(y)),d=w(b,!0);p(b);var c=k(b,2),W=w(c,!0);p(c);var g=k(c,2),v=w(g,!0);p(g),j(),p(y);var T=k(y,2),L=w(T);j(2),p(T),p(r),M(()=>{Be(r,`top: ${l(h).top??""}px; left: ${l(h).left??""}px`),E(d,l(n).volumeNumber),E(W,l(n).pageNumber),E(v,l(n).numberWithinPage),Ge(L,"href",`https://read.akvan.dev/km/${l(n).volumeNumber??""}/${l(n).pageNumber??""}`)}),I(s,r)};ee(_,s=>{l(n)&&s(N)})}var f=k(_,2),i=w(f);i.__click=[Qe,u,a],i.__keydown=[je,u,a];var x=w(i,!0);p(i),p(f);var o=k(f,2);Ue(o,23,()=>l(a),s=>`${s.volumeNumber}-${s.pageNumber}-${s.numberWithinPage}`,(s,r,y)=>{var b=le(),d=Q(b);{var c=g=>{var v=at();v.__click=[et,u,r],v.__keydown=[tt,u,r];var T=w(v,!0);p(v),M(()=>E(T,l(r).headingText)),I(g,v)},W=g=>{var v=ot(),T=w(v),L=w(T,!0);p(T);var P=k(T,2);P.__click=[rt,u,r],P.__keydown=[st,u,r];var $=w(P,!0),C=k($),oe=w(C,!0);p(C),p(P);var R=k(P,2);R.__click=[it,u,r],R.__keydown=[nt,u,r];var K=w(R,!0),z=k(K),ue=w(z,!0);p(z),p(R),p(v),M(D=>{E(L,D),E($,l(r).hemistichOne.text),E(oe,l(r).hemistichOne.hasNotes?"*":""),E(K,l(r).hemistichTwo.text),E(ue,l(r).hemistichTwo.hasNotes?"*":"")},[()=>{var D;return(D=l(r).numberListed)==null?void 0:D.toLocaleString("fa")}]),I(g,v)};ee(d,g=>{l(r).heading&&l(y)!==0?g(c):g(W,!1)})}I(s,b)}),p(o),M(()=>{E(x,l(a)[0].headingText),o.dir=o.dir}),I(e,m),Ie()}$e(["click","keydown"]);export{vt as component};
